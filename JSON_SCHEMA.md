# Entity JSON Schema Documentation

## Overview
This document describes the JSON schema for defining entities to be generated by the ABP Generator script.

## Full Schema

```json
{
  "namespace": "string (required)",
  "moduleName": "string (required)",
  "entityName": "string (required)",
  "entityNamePlural": "string (optional, defaults to entityName + 's')",
  "baseClass": "string (optional, defaults to 'FullAuditedAggregateRoot')",
  "idType": "string (optional, defaults to 'Guid')",
  "dbContextName": "string (optional, defaults to moduleName + 'DbContext')",
  "properties": [
    {
      "name": "string (required)",
      "type": "string (required)",
      "required": "boolean (optional, defaults to false)",
      "nullable": "boolean (optional, defaults to false)",
      "maxLength": "integer (optional)",
      "minLength": "integer (optional)",
      "defaultValue": "string (optional)",
      "validation": {
        "pattern": "string (optional) - predefined: email, phone, url, alphanumeric, or custom regex",
        "min": "number (optional) - for numeric types",
        "max": "number (optional) - for numeric types",
        "asyncUnique": "boolean (optional) - async uniqueness check",
        "customValidator": "string (optional) - custom validator class name"
      }
    }
  ],
  "relationships": [
    {
      "name": "string (required)",
      "type": "string (required) - OneToOne, OneToMany, ManyToOne, ManyToMany",
      "relatedEntity": "string (required)",
      "foreignKey": "string (optional)"
    }
  ],
  "options": {
    "generatePermissions": "boolean (optional, defaults to true)",
    "generateLocalization": "boolean (optional, defaults to true)",
    "advancedValidation": "boolean (optional, defaults to true)",
    "apiDocumentation": "boolean (optional, defaults to true)",
    "comprehensiveTests": "boolean (optional, defaults to false)",
    "auditLogging": "boolean (optional, defaults to false)"
  }
}
```

## Field Descriptions

### Root Level

- **namespace** (required): The root namespace for the project (e.g., `MyCompany.MyProject`)
- **moduleName** (required): The module name (e.g., `Catalog`, `Blog`)
- **entityName** (required): The entity name (e.g., `Product`, `Post`)
- **entityNamePlural** (optional): Plural form of entity name (defaults to `entityName + "s"`)
- **baseClass** (optional): Entity base class. Options:
  - `Entity` - Basic entity with only Id
  - `AggregateRoot` - Domain-driven design aggregate root
  - `BasicAggregateRoot` - Basic aggregate with concurrency token
  - `AuditedEntity` - Entity with creation and modification audit fields
  - `AuditedAggregateRoot` - Audited aggregate root
  - `FullAuditedEntity` - Audited entity with soft delete
  - `FullAuditedAggregateRoot` (default) - Full audited aggregate root
- **idType** (optional): Primary key type: `Guid` (default), `long`, or `int`
- **dbContextName** (optional): Custom DbContext name (defaults to `moduleName + "DbContext"`)

### Properties

Each property object supports:

- **name** (required): Property name (PascalCase)
- **type** (required): C# type (`string`, `int`, `long`, `decimal`, `DateTime`, `bool`, `Guid`, etc.)
- **required** (optional): If true, adds `[Required]` attribute and validation
- **nullable** (optional): If true, makes the property nullable (`type?`)
- **maxLength** (optional): Maximum length for strings (adds `[StringLength]`)
- **minLength** (optional): Minimum length for strings
- **defaultValue** (optional): Default value for the property

#### Validation Object

- **pattern** (optional): Validation pattern
  - Predefined: `email`, `phone`, `url`, `alphanumeric`
  - Custom regex: Any valid regex pattern
- **min** (optional): Minimum value for numeric types
- **max** (optional): Maximum value for numeric types
- **asyncUnique** (optional): Enable async uniqueness validation
- **customValidator** (optional): Name of a custom validator class

### Relationships

- **name** (required): Navigation property name
- **type** (required): Relationship type
  - `OneToOne` - One-to-one relationship
  - `OneToMany` - One-to-many relationship
  - `ManyToOne` - Many-to-one relationship
  - `ManyToMany` - Many-to-many relationship
- **relatedEntity** (required): Name of the related entity
- **foreignKey** (optional): Foreign key property name

### Options

Advanced feature flags:

- **generatePermissions** (default: true): Generate permission definitions and apply `[Authorize]` attributes
- **generateLocalization** (default: true): Generate localization keys for UI
- **advancedValidation** (default: true): Generate advanced FluentValidation validators with regex, async, custom rules
- **apiDocumentation** (default: true): Add Swagger/OpenAPI attributes (`[SwaggerOperation]`, `[ProducesResponseType]`)
- **comprehensiveTests** (default: false): Generate comprehensive unit and integration tests
- **auditLogging** (default: false): Generate audit logging configuration

## Examples

### Simple Entity

```json
{
  "namespace": "MyCompany.MyProject",
  "moduleName": "Blog",
  "entityName": "Post",
  "baseClass": "AuditedAggregateRoot",
  "properties": [
    {
      "name": "Title",
      "type": "string",
      "required": true,
      "maxLength": 200
    },
    {
      "name": "Content",
      "type": "string",
      "required": true
    },
    {
      "name": "IsPublished",
      "type": "bool",
      "required": true,
      "defaultValue": "false"
    }
  ],
  "options": {
    "generatePermissions": true,
    "apiDocumentation": true
  }
}
```

### Advanced Entity with Validation

```json
{
  "namespace": "MyCompany.MyProject",
  "moduleName": "Catalog",
  "entityName": "Product",
  "entityNamePlural": "Products",
  "baseClass": "FullAuditedAggregateRoot",
  "idType": "Guid",
  "dbContextName": "CatalogDbContext",
  "properties": [
    {
      "name": "Name",
      "type": "string",
      "required": true,
      "maxLength": 200,
      "minLength": 3,
      "validation": {
        "pattern": "alphanumeric",
        "asyncUnique": true
      }
    },
    {
      "name": "SKU",
      "type": "string",
      "required": true,
      "maxLength": 50,
      "validation": {
        "pattern": "^[A-Z0-9-]+$",
        "asyncUnique": true
      }
    },
    {
      "name": "Price",
      "type": "decimal",
      "required": true,
      "validation": {
        "min": 0,
        "max": 999999.99
      }
    },
    {
      "name": "Description",
      "type": "string",
      "required": false,
      "nullable": true,
      "maxLength": 1000
    },
    {
      "name": "CategoryId",
      "type": "Guid",
      "required": true
    }
  ],
  "relationships": [
    {
      "name": "Category",
      "type": "ManyToOne",
      "relatedEntity": "Category",
      "foreignKey": "CategoryId"
    }
  ],
  "options": {
    "generatePermissions": true,
    "generateLocalization": true,
    "advancedValidation": true,
    "apiDocumentation": true,
    "comprehensiveTests": true,
    "auditLogging": true
  }
}
```

### Entity with Relationships

```json
{
  "namespace": "MyCompany.MyProject",
  "moduleName": "Ecommerce",
  "entityName": "Order",
  "properties": [
    {
      "name": "OrderNumber",
      "type": "string",
      "required": true,
      "maxLength": 50
    },
    {
      "name": "CustomerId",
      "type": "Guid",
      "required": true
    },
    {
      "name": "OrderDate",
      "type": "DateTime",
      "required": true
    },
    {
      "name": "TotalAmount",
      "type": "decimal",
      "required": true
    }
  ],
  "relationships": [
    {
      "name": "Customer",
      "type": "ManyToOne",
      "relatedEntity": "Customer",
      "foreignKey": "CustomerId"
    },
    {
      "name": "OrderItems",
      "type": "OneToMany",
      "relatedEntity": "OrderItem"
    }
  ]
}
```

## Supported C# Types

- `string` - Text
- `int` - 32-bit integer
- `long` - 64-bit integer
- `decimal` - Decimal number
- `double` - Double precision float
- `float` - Single precision float
- `bool` - Boolean
- `DateTime` - Date and time
- `Guid` - Globally unique identifier
- `byte[]` - Byte array
- Custom types (e.g., enums, value objects)

## Best Practices

1. **Use descriptive names**: Entity and property names should be clear and follow C# naming conventions
2. **Set appropriate base classes**: Choose based on your requirements:
   - Use `FullAuditedAggregateRoot` for most entities (includes soft delete)
   - Use `AuditedAggregateRoot` if you don't need soft delete
   - Use `Entity` or `AggregateRoot` for simple lookup tables
3. **Add validation**: Use the `validation` object to enforce business rules
4. **Enable features selectively**: Don't enable all options for simple entities
5. **Test your JSON**: Use a JSON validator before running the generator
6. **Version control**: Keep your JSON definitions in source control

## Validation Patterns

### Predefined Patterns

- `email` - Email address format
- `phone` - Phone number format
- `url` - URL format
- `alphanumeric` - Letters, numbers, spaces, hyphens, underscores only

### Custom Regex

You can provide any valid .NET regex pattern:

```json
{
  "validation": {
    "pattern": "^[A-Z]{2}[0-9]{4}$"
  }
}
```

## See Also

- [ABP Framework Documentation](https://abp.io/docs/latest)
- [Entity Design](https://abp.io/docs/latest/framework/architecture/domain-driven-design/entities)
- [Repository Pattern](https://abp.io/docs/latest/framework/architecture/domain-driven-design/repositories)
- [Application Services](https://abp.io/docs/latest/framework/architecture/domain-driven-design/application-services)

